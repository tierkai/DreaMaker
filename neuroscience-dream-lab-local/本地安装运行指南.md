# 神经梦境实验室 - 本地安装运行指南

## 📋 项目概述

神经梦境实验室是一个集成了3D可视化、用户认证、实验管理和AI智能体的综合性科研平台。

### 🎯 主要功能
- **神经映射3D可视化** - 实时3D大脑神经网络展示
- **3D小鼠数字孪生** - 基于物理引擎的完整生理模型
- **实验管理系统** - 支持5种实验类型的完整管理
- **AI智能沙龙** - 4个专业智能体协作对话
- **用户认证系统** - 完整的注册登录权限管理

### 🛠️ 技术栈
- **前端**: React 18 + TypeScript + Vite
- **3D渲染**: Three.js + @react-three/fiber
- **后端**: Supabase (数据库 + 认证 + Edge Functions)
- **样式**: TailwindCSS + Radix UI
- **状态管理**: Zustand + React Query

---

## 🚀 快速开始

### 环境要求
- **Node.js**: >= 18.0.0
- **包管理器**: pnpm (推荐) 或 npm
- **浏览器**: Chrome 90+, Firefox 88+, Edge 90+, Safari 14+
- **硬件**: 支持WebGL 2.0的显卡

### 安装步骤

#### 1. 克隆项目
```bash
# 解压项目文件到本地目录
cd neuroscience-dream-lab-local
```

#### 2. 安装依赖
```bash
# 使用 pnpm (推荐)
pnpm install

# 或使用 npm
npm install

# 或使用 yarn
yarn install
```

#### 3. 配置环境变量
创建 `.env.local` 文件：
```bash
# 复制环境变量模板
cp .env.example .env.local
```

编辑 `.env.local` 文件：
```env
# Supabase 配置
VITE_SUPABASE_URL=你的_supabase_项目_url
VITE_SUPABASE_ANON_KEY=你的_supabase_匿名密钥

# MiniMax AI 配置 (可选，用于AI沙龙功能)
VITE_MINIMAX_API_KEY=你的_minimax_api_key
VITE_MINIMAX_GROUP_ID=你的_group_id

# 开发模式配置
VITE_DEV_MODE=true
```

#### 4. 启动开发服务器
```bash
# 使用 pnpm
pnpm dev

# 或使用 npm
npm run dev

# 或使用 yarn
yarn dev
```

#### 5. 访问应用
打开浏览器访问: http://localhost:5173

---

## 📁 项目结构

```
neuroscience-dream-lab-local/
├── src/
│   ├── components/          # React组件
│   │   ├── AISalon/        # AI沙龙相关组件
│   │   ├── DigitalTwin/    # 数字孪生组件
│   │   ├── Experiments/    # 实验管理组件
│   │   └── Layout/         # 布局组件
│   ├── contexts/           # React上下文
│   ├── hooks/              # 自定义Hooks
│   ├── lib/                # 工具库
│   ├── pages/              # 页面组件
│   ├── services/           # API服务
│   ├── store/              # 状态管理
│   ├── types/              # TypeScript类型定义
│   └── utils/              # 工具函数
├── supabase/               # Supabase配置
│   ├── functions/         # Edge Functions
│   ├── migrations/        # 数据库迁移
│   └── schema.sql         # 数据库架构
├── public/                # 静态资源
├── package.json           # 项目配置
├── vite.config.ts         # Vite配置
├── tailwind.config.js     # TailwindCSS配置
└── tsconfig.json          # TypeScript配置
```

---

## 🔧 配置说明

### Supabase配置

1. **创建Supabase项目**
   - 访问 [supabase.com](https://supabase.com)
   - 创建新项目
   - 获取项目URL和API密钥

2. **设置数据库**
   ```sql
   -- 在Supabase SQL编辑器中执行
   -- 参考 supabase/schema.sql 文件
   ```

3. **配置认证**
   - 在Supabase控制台启用Email认证
   - 配置重定向URL

### MiniMax AI配置 (可选)

1. **获取API密钥**
   - 访问MiniMax开放平台
   - 创建应用并获取API密钥

2. **配置Edge Function**
   ```bash
   # 部署AI沙龙功能
   supabase functions deploy ai-salon-chat
   ```

---

## 🎯 功能模块

### 1. 神经映射3D可视化
- **文件**: `src/pages/DreamLab/NeuralMapping.tsx`
- **功能**: 13个脑区节点，20+神经连接动态展示
- **技术**: Three.js + @react-three/fiber

### 2. 3D小鼠数字孪生
- **文件**: `src/components/DigitalTwin/MouseModel3D.tsx`
- **功能**: 完整小鼠模型，物理引擎仿真
- **技术**: Cannon.js + @react-three/cannon

### 3. 实验管理系统
- **文件**: `src/pages/Experiments/index.tsx`
- **功能**: 5种实验类型支持
- **技术**: React Hook Form + Zod验证

### 4. AI智能沙龙
- **文件**: `src/pages/AISalon/index.tsx`
- **功能**: 4个专业智能体协作
- **技术**: MiniMax API + WebSocket

### 5. 用户认证系统
- **文件**: `src/contexts/AuthContext.tsx`
- **功能**: 注册登录，权限管理
- **技术**: Supabase Auth

---

## 🛠️ 开发命令

### 常用命令
```bash
# 启动开发服务器
pnpm dev

# 构建生产版本
pnpm build

# 预览构建结果
pnpm preview

# 代码检查
pnpm lint

# 类型检查
pnpm type-check

# 清理依赖
pnpm clean
```

### Supabase命令
```bash
# 启动本地Supabase
supabase start

# 部署Edge Functions
supabase functions deploy

# 查看日志
supabase functions logs

# 重置数据库
supabase db reset
```

---

## 🐛 故障排除

### 常见问题

#### 1. 依赖安装失败
```bash
# 清理缓存重新安装
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

#### 2. 端口占用
```bash
# 查看端口占用
lsof -i :5173

# 杀死占用进程
kill -9 <PID>
```

#### 3. WebGL支持检查
```javascript
// 在浏览器控制台运行
console.log(WebGLRenderingContext);
```

#### 4. TypeScript错误
```bash
# 重新生成类型
pnpm type-check --noEmit
```

#### 5. Supabase连接问题
- 检查 `.env.local` 配置
- 确认网络连接
- 验证API密钥有效性

### 调试技巧

#### 1. 浏览器开发者工具
- 打开F12开发者工具
- 查看Console、Network、Performance标签
- 检查WebGL支持情况

#### 2. React DevTools
- 安装React Developer Tools扩展
- 查看组件树和状态
- 分析性能瓶颈

#### 3. 网络调试
- 检查API请求状态
- 查看响应数据格式
- 验证认证令牌

---

## 📊 性能优化

### 构建优化
- **代码分割**: 使用React.lazy懒加载
- **资源压缩**: Vite自动优化
- **缓存策略**: 配置浏览器缓存

### 运行时优化
- **3D渲染**: 使用requestAnimationFrame
- **状态管理**: 避免不必要的重渲染
- **内存管理**: 及时清理3D资源

### 性能监控
```javascript
// 在开发模式启用性能监控
if (import.meta.env.DEV) {
  import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
    getCLS(console.log);
    getFID(console.log);
    getFCP(console.log);
    getLCP(console.log);
    getTTFB(console.log);
  });
}
```

---

## 🔐 安全配置

### 环境变量安全
- 敏感信息不要提交到版本控制
- 使用 `.env.local` 本地配置文件
- 生产环境使用环境变量管理

### 认证安全
- 启用Supabase RLS策略
- 配置CORS策略
- 使用HTTPS部署

### 数据安全
- 定期备份数据库
- 监控异常访问
- 实施访问控制

---

## 🚀 部署指南

### 构建生产版本
```bash
# 构建生产版本
pnpm build

# 构建结果在 dist/ 目录
ls dist/
```

### 部署选项

#### 1. Vercel部署
```bash
# 安装Vercel CLI
npm i -g vercel

# 部署
vercel --prod
```

#### 2. Netlify部署
```bash
# 安装Netlify CLI
npm i -g netlify-cli

# 部署
netlify deploy --prod --dir=dist
```

#### 3. 自定义服务器
```bash
# 使用nginx
sudo cp -r dist/* /var/www/html/

# 使用Apache
sudo cp -r dist/* /var/www/html/
```

---

## 📚 学习资源

### 技术文档
- [React官方文档](https://react.dev)
- [TypeScript文档](https://www.typescriptlang.org)
- [Vite文档](https://vitejs.dev)
- [Three.js文档](https://threejs.org)
- [Supabase文档](https://supabase.com/docs)

### 最佳实践
- [React最佳实践](https://react.dev/learn/thinking-in-react)
- [TypeScript最佳实践](https://typescript-eslint.io/rules/)
- [性能优化指南](https://web.dev/performance/)

### 社区资源
- [React中文社区](https://react.docschina.org)
- [TypeScript中文文档](https://www.tslang.cn)
- [Three.js中文社区](https://threejs.org.cn)

---

## 📞 技术支持

### 获取帮助
1. 查看本指南的故障排除部分
2. 检查项目GitHub Issues
3. 参考官方文档
4. 联系技术支持团队

### 报告问题
请提供以下信息：
- 操作系统和浏览器版本
- 错误信息和截图
- 重现步骤
- 期望的行为

---

## 📝 更新日志

### v1.0.0 (2025-10-31)
- ✅ 完整的React + TypeScript项目结构
- ✅ 神经映射3D可视化功能
- ✅ 3D小鼠数字孪生系统
- ✅ 实验管理系统
- ✅ AI智能沙龙功能
- ✅ 用户认证系统
- ✅ 完整的本地开发环境

---

*最后更新: 2025-10-31*  
*文档版本: v1.0*  
*作者: MiniMax Agent*